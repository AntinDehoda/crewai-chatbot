"""
Main - –≥–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫—É —á–∞—Ç-–±–æ—Ç–∞
"""
import os
import sys
from dotenv import load_dotenv
from crew.chat_crew import ChatCrew


def check_environment():
    """–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è"""
    load_dotenv()
    
    if not os.getenv("ANTHROPIC_API_KEY"):
        print("‚ùå –ü–æ–º–∏–ª–∫–∞: ANTHROPIC_API_KEY –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ .env —Ñ–∞–π–ª—ñ")
        print("–°—Ç–≤–æ—Ä—ñ—Ç—å .env —Ñ–∞–π–ª –∑–∞ —à–∞–±–ª–æ–Ω–æ–º .env.example")
        sys.exit(1)
    
    print("‚úì –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ")


def print_welcome():
    """–í—ñ—Ç–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"""
    print("\n" + "="*60)
    print("ü§ñ –ß–∞—Ç-–±–æ—Ç –Ω–∞ –±–∞–∑—ñ CrewAI + Claude")
    print("="*60)
    print("\n–ö–æ–º–∞–Ω–¥–∏:")
    print("  - –ü—Ä–æ—Å—Ç–æ –ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è")
    print("  - 'clear' –∞–±–æ 'reset' - –æ—á–∏—Å—Ç–∏—Ç–∏ –ø–∞–º'—è—Ç—å")
    print("  - 'exit' –∞–±–æ 'quit' - –≤–∏–π—Ç–∏ –∑ –ø—Ä–æ–≥—Ä–∞–º–∏")
    print("\n" + "="*60 + "\n")


def main():
    """–û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑–∞–ø—É—Å–∫—É —á–∞—Ç-–±–æ—Ç–∞"""
    
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
    check_environment()
    
    # –í—ñ—Ç–∞–Ω–Ω—è
    print_welcome()
    
    # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ChatCrew
    print("–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏...")
    chat_crew = ChatCrew()
    print("‚úì –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞!\n")
    
    # –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª —á–∞—Ç—É
    while True:
        try:
            # –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–≤–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            user_input = input("üë§ –í–∏: ").strip()
            
            # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥
            if not user_input:
                continue
            
            if user_input.lower() in ['exit', 'quit', '–≤–∏—Ö—ñ–¥']:
                print("\nüëã –î–æ –ø–æ–±–∞—á–µ–Ω–Ω—è!")
                break
            
            if user_input.lower() in ['clear', 'reset', '–æ—á–∏—Å—Ç–∏—Ç–∏']:
                chat_crew.reset_memory()
                print("‚úì –ü–∞–º'—è—Ç—å –æ—á–∏—â–µ–Ω–æ. –ü–æ—á–∏–Ω–∞—î–º–æ –Ω–æ–≤—É —Ä–æ–∑–º–æ–≤—É!\n")
                continue
            
            # –û–±—Ä–æ–±–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            print("\nü§ñ –ë–æ—Ç –æ–±—Ä–æ–±–ª—è—î –≤–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...\n")
            response = chat_crew.chat(user_input)
            
            # –í–∏–≤–µ–¥–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
            print(f"\nü§ñ –ë–æ—Ç: {response}\n")
            print("-" * 60 + "\n")
            
        except KeyboardInterrupt:
            print("\n\nüëã –ü—Ä–æ–≥—Ä–∞–º—É –ø–µ—Ä–µ—Ä–≤–∞–Ω–æ. –î–æ –ø–æ–±–∞—á–µ–Ω–Ω—è!")
            break
        except Exception as e:
            print(f"\n‚ùå –ü–æ–º–∏–ª–∫–∞: {e}")
            print("–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å 'exit' –¥–ª—è –≤–∏—Ö–æ–¥—É\n")


if __name__ == "__main__":
    main()
